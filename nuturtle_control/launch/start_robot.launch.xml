<launch>

  <!-- source for robot commands-->
  <arg name="cmd_src" default="circle" description="cmd_vel publisher: circle, teleop, or none" />

  <!-- real robot or simulation -->
  <arg name="robot" default="nusim" description="interface: nusim (for simulation) or localhost (for turtlebot) or none" />
  
  <!-- (must be false when localhost is on) -->
  <arg name="use_rviz" default="true" description="use rviz: true or false" /> 
  

  <!-- circle command node-->
  <group if="$(eval '\'$(var cmd_src)\' == \'circle\'')">
    <node pkg="nuturtle_control" exec="circle" name="circle"/>
  </group>

  <!-- teleop command node-->
  <group if="$(eval '\'$(var cmd_src)\' == \'teleop\'')">
    <node pkg="teleop_twist_keyboard" exec="teleop_twist_keyboard" name="teleop_twist_keyboard"/>
  </group>

  <!-- robot interface. TODO: add rviz config -->
  <group if="$(eval '\'$(var robot)\' == \'nusim\'')">
      <!-- start simulator -->
      <include file="$(find-pkg-share nusim)/launch/nusim.launch.xml" />

      <!-- run odometry node -->
      <node pkg="nuturtle_control" exec="odometry" name="odometry"/>

      <!-- run turtle_control node -->
      <node pkg="nuturtle_control" exec="turtle_control" name="turtle_control"/>

      <!-- display red turtle-->
      <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py">
          <arg name="use_rviz" value="false"/>
          <arg name="use_jsp" value="false"/>
          <arg name="color" value="red"/>
      </include>
    
  </group>


  <!-- rviz -->
  <group if="$(eval '\'$(var use_rviz)\' == \'true\'')">
    <node pkg="rviz2" exec="rviz2" name="rviz2">       

    </node>
  </group>

  <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py">
        <arg name="use_rviz" value="false"/>
        <arg name="use_jsp" value="false"/>
        <arg name="color" value="blue"/>
  </include>

  <!-- Identity transform between nusim/world and odom -->
  <node pkg="tf2_ros"
      exec="static_transform_publisher"
      name="nusim_world_to_odom"
      args="
          --x 0
          --y 0
          --z 0
          --qx 0
          --qy 0
          --qz 0
          --qw 1
          --frame-id nusim/world
          --child-frame-id odom "
  />

</launch>

